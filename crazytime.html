<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cubozzi - CrazyTime Stats Live</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap');
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: #121212;
            background-image: url('images/background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            padding: 20px;
        }
        
        .banner {
            position: relative;
            width: 100%;
            background: rgba(20, 30, 20, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            box-sizing: border-box;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 0 2px rgba(0,255,76,0.5);
            overflow: hidden;
            transform-style: preserve-3d;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        
        .banner:hover {
            box-shadow: 0 15px 40px rgba(0,0,0,0.6), 0 0 0 2px rgba(0,255,76,0.8), 0 0 20px rgba(0,255,76,0.3);
            transform: translateY(-5px);
        }
        
        .banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(0,255,76,0.1), transparent 70%);
            z-index: 0;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }
        
        .page-title {
            display: flex;
            align-items: center;
        }
        
        .page-title img {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            border-radius: 50%;
            border: 2px solid rgba(0,255,76,0.7);
            box-shadow: 0 0 10px rgba(0,255,76,0.5);
        }
        
        .page-title h1 {
            font-size: 32px;
            font-weight: 800;
            margin: 0;
            color: white;
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
        }
        
        .nav-link {
            padding: 10px 20px;
            background: rgba(0, 20, 0, 0.8);
            border-radius: 20px;
            color: #00ff4c;
            text-decoration: none;
            font-weight: 600;
            border: 1px solid rgba(0,255,76,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-link:hover {
            background: rgba(0, 40, 0, 0.9);
            border-color: rgba(0,255,76,0.8);
            box-shadow: 0 0 15px rgba(0,255,76,0.4);
            transform: translateY(-3px);
        }
        
        .live-game-panel {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            border: 1px solid rgba(0,255,76,0.2);
            box-shadow: inset 0 0 20px rgba(0,255,76,0.1);
            position: relative;
            z-index: 2;
        }
        
        .section-title {
            margin-top: 0;
            color: #00ff4c;
            font-size: 24px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0,255,76,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 20px;
        }
        
        .game-info-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .status-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .status-card {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            background: rgba(0, 20, 0, 0.8);
            border-radius: 16px;
            border: 1px solid rgba(0,255,76,0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .status-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0,255,76,0.8);
            box-shadow: 0 10px 25px rgba(0,0,0,0.5), 0 0 15px rgba(0,255,76,0.3);
        }
        
        .status-label {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
        }
        
        .status-value {
            font-size: 24px;
            font-weight: 800;
            color: white;
        }
        
        .history-title {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 0 10px;
            color: #ccc;
        }
        
        .history-container {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 10px;
            scrollbar-width: thin;
            scrollbar-color: rgba(0,255,76,0.5) rgba(0,0,0,0.3);
            -webkit-overflow-scrolling: touch;
            padding-bottom: 15px;
        }
        
        .history-container::-webkit-scrollbar {
            height: 8px;
        }
        
        .history-container::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }
        
        .history-container::-webkit-scrollbar-thumb {
            background-color: rgba(0,255,76,0.5);
            border-radius: 10px;
        }
        
        .segment {
            flex: 0 0 auto;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            position: relative;
            border: 2px solid transparent;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }
        
        .segment:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            z-index: 2;
        }
        
        .segment img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-width: 100%;
            border-radius: 50%;
        }
        
        .segment-1 {
            background: linear-gradient(135deg, #cf3535, #fa5858);
            color: white;
        }
        
        .segment-2 {
            background: linear-gradient(135deg, #3569cf, #5896fa);
            color: white;
        }
        
        .segment-5 {
            background: linear-gradient(135deg, #cfb435, #fad758);
            color: black;
        }
        
        .segment-10 {
            background: linear-gradient(135deg, #9035cf, #c258fa);
            color: white;
        }
        
        .segment-bonus, .segment-cash_hunt, .segment-coinflip, .segment-pachinko, .segment-crazy_time {
            background: linear-gradient(135deg, #35cf69, #58fa8d);
            color: black;
            font-size: 12px;
        }
        
        .segment-multiplier {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #FF9900;
            color: black;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(225px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: rgba(0, 20, 0, 0.8);
            border-radius: 16px;
            border: 1px solid rgba(0,255,76,0.25);
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0,255,76,0.8);
            box-shadow: 0 15px 25px rgba(0,0,0,0.4), 0 0 15px rgba(0,255,76,0.3);
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-header .stat-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }
        
        .stat-icon-container img, .frequency-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-width: 100%;
        }
        
        .stat-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
            margin: 0;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 800;
            color: white;
        }
        
        .chronology-table-container {
            margin-top: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            border: 1px solid rgba(0,255,76,0.2);
            box-shadow: inset 0 0 20px rgba(0,255,76,0.1);
        }
        
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .chronology-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .chronology-table th,
        .chronology-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            vertical-align: middle;
        }
        
        .chronology-table th {
            font-weight: 600;
            color: #ccc;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .chronology-table td {
            font-weight: 500;
        }
        
        .slot-result img, .spin-result img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }
        
        .last-hits-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .last-hits-table th,
        .last-hits-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .last-hits-table th {
            font-weight: 600;
            color: #ccc;
            font-size: 14px;
        }
        
        .last-hits-table td {
            font-weight: 500;
        }
        
        .last-hits-table tr:last-child td {
            border-bottom: none;
        }
        
        .probability-bar {
            height: 8px;
            width: 100%;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .probability-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .fill-1 { background: linear-gradient(90deg, #cf3535, #fa5858); }
        .fill-2 { background: linear-gradient(90deg, #3569cf, #5896fa); }
        .fill-5 { background: linear-gradient(90deg, #cfb435, #fad758); }
        .fill-10 { background: linear-gradient(90deg, #9035cf, #c258fa); }
        .fill-ch { background: linear-gradient(90deg, #35cf69, #58fa8d); }
        .fill-cf { background: linear-gradient(90deg, #35cfcf, #58fafa); }
        .fill-p { background: linear-gradient(90deg, #cf9e35, #fac458); }
        .fill-ct { background: linear-gradient(90deg, #cf35cf, #fa58fa); }
        
        .frequency-section {
            margin-top: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            border: 1px solid rgba(0,255,76,0.2);
            box-shadow: inset 0 0 20px rgba(0,255,76,0.1);
        }
        
        .frequency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .frequency-card {
            background: rgba(0, 20, 0, 0.8);
            border-radius: 16px;
            border: 1px solid rgba(0,255,76,0.25);
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .frequency-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0,255,76,0.8);
            box-shadow: 0 15px 25px rgba(0,0,0,0.4), 0 0 15px rgba(0,255,76,0.3);
        }
        
        .frequency-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .frequency-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }
        
        .frequency-title {
            font-size: 16px;
            font-weight: 600;
            color: white;
            margin: 0;
        }
        
        .spins-data {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .spins-item {
            text-align: center;
            flex: 1;
        }
        
        .spins-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .spins-value {
            font-size: 18px;
            font-weight: 700;
            color: white;
        }
        
        .progress-container {
            margin-top: 15px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .progress-text {
            color: #ccc;
        }
        
        .progress-percentage {
            color: #00ff4c;
            font-weight: 600;
        }
        
        .multiplier-section {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .multiplier-item {
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 8px;
            min-width: 30px;
        }
        
        .multiplier-value {
            font-size: 16px;
            font-weight: 700;
            color: #FF9900;
            margin-bottom: 2px;
        }
        
        .multiplier-count {
            font-size: 12px;
            color: #ccc;
        }
        
        .blink-live {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: #ff4c4c;
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0% { opacity: 0.2; }
            50% { opacity: 1; box-shadow: 0 0 10px #ff4c4c; }
            100% { opacity: 0.2; }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(0, 255, 76, 0.3);
            border-radius: 50%;
            border-top-color: #00ff4c;
            animation: spinner 1s linear infinite;
        }
        
        .loading-text {
            margin-top: 20px;
            color: #00ff4c;
            font-size: 18px;
            font-weight: 600;
        }
        
        @keyframes spinner {
            to {
                transform: rotate(360deg);
            }
        }
        
        .refresh-button {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 20, 0, 0.8);
            border: 1px solid rgba(0,255,76,0.3);
            color: #00ff4c;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .refresh-button:hover {
            background: rgba(0, 40, 0, 0.9);
            transform: rotate(180deg);
            border-color: rgba(0,255,76,0.8);
            box-shadow: 0 0 15px rgba(0,255,76,0.4);
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: rgba(0, 20, 0, 0.9);
            border-radius: 10px;
            border-left: 4px solid #00ff4c;
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(200%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .countdown-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .countdown-box {
            width: 28px;
            height: 35px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: #ff4c4c;
            position: relative;
            overflow: hidden;
        }
        
        .countdown-box.blink {
            animation: pulsate 1s infinite;
        }
        
        @keyframes pulsate {
            0% { background: rgba(0, 0, 0, 0.5); }
            50% { background: rgba(255, 76, 76, 0.2); }
            100% { background: rgba(0, 0, 0, 0.5); }
        }
        
        .countdown-separator {
            font-size: 20px;
            font-weight: 700;
            color: #ff4c4c;
            line-height: 1;
        }
        
        /* Fix dimensioni per mobile */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .banner {
                padding: 20px;
            }
            
            .stats-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .frequency-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .status-row {
                flex-direction: column;
            }
            
            .status-card {
                width: 100%;
            }
            
            .page-title h1 {
                font-size: 24px;
            }
            
            .chronology-table {
                font-size: 12px;
            }
            
            .chronology-table th,
            .chronology-table td {
                padding: 6px;
            }
            
            .slot-result img, .spin-result img {
                width: 30px;
                height: 30px;
            }
            
            .segment {
                width: 40px;
                height: 40px;
            }
            
            .section-title {
                font-size: 20px;
            }
        }
        
        /* Fix per popup dettagli */
        #detail-popup {
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        #detail-popup img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
        }
        
        /* Sistemazioni per ottimizzare rendering */
        .time-filter {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }
        
        .time-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .time-button {
            background: rgba(0, 20, 0, 0.7);
            color: white;
            border: 1px solid rgba(0,255,76,0.3);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
        }
        
        .time-button:hover {
            background: rgba(0, 40, 0, 0.9);
            border-color: rgba(0,255,76,0.6);
        }
        
        .time-button.active {
            background: rgba(0, 60, 0, 0.9);
            border-color: rgba(0,255,76,0.8);
            color: #00ff4c;
            box-shadow: 0 0 10px rgba(0,255,76,0.3);
        }
        
        .summary-info {
            color: #ccc;
            font-size: 14px;
            margin-top: 5px;
        }
        
        /* Fix dimensioni immagini */
        .segment img, .stat-icon-container img, .frequency-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Caricamento dati CrazyTime...</div>
    </div>
    
    <div class="container">
        <div class="banner">
            <button class="refresh-button" id="refresh-btn" title="Aggiorna dati">
                <i class="fas fa-sync"></i>
            </button>
            
            <div class="page-header">
                <div class="page-title">
                    <img src="images/logo.png" alt="Cubozzi Logo">
                    <h1>CrazyTime Stats</h1>
                </div>
                <div class="nav-links">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i> Home
                    </a>
                </div>
            </div>
            
            <div class="time-filter">
                <div class="time-buttons">
                    <button class="time-button" data-hours="1">Ultime 1 ora</button>
                    <button class="time-button active" data-hours="6">Ultime 6 ore</button>
                    <button class="time-button" data-hours="12">Ultime 12 ore</button>
                    <button class="time-button" data-hours="24">Ultime 24 ore</button>
                </div>
                <div class="summary-info" id="summary-info">
                    Ultime 6 ore - 437 Giocate
                </div>
            </div>
            
            <div class="live-game-panel">
                <h3 class="section-title">
                    <div class="blink-live"></div> STATO LIVE DEL GIOCO
                </h3>
                
                <div class="game-info-container">
                    <div class="status-row">
                        <div class="status-card">
                            <div class="status-label">Ultimo Risultato</div>
                            <div class="status-value" id="last-result">--</div>
                        </div>
                        
                        <div class="status-card">
                            <div class="status-label">Prossimo Risultato Tra</div>
                            <div class="status-value">
                                <div class="countdown-container" id="countdown">
                                    <div class="countdown-box" id="minutes">--</div>
                                    <div class="countdown-separator">:</div>
                                    <div class="countdown-box" id="seconds">--</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="status-card">
                            <div class="status-label">Giri Ultime 24 ore</div>
                            <div class="status-value" id="spins-24h">--</div>
                        </div>
                    </div>
                    
                    <div class="history-title">Ultimi 50 Risultati</div>
                    <div class="history-container" id="history-container">
                        <!-- Gli ultimi risultati verranno inseriti qui -->
                    </div>
                </div>
            </div>
            
            <div class="chronology-table-container">
                <h3 class="section-title">
                    <i class="fas fa-history"></i> CRONOLOGIA GIOCATE
                </h3>
                
                <div class="table-responsive">
                    <table class="chronology-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Risultato Slot</th>
                                <th>Risultato Spin</th>
                                <th>Moltiplicatore</th>
                                <th>Pagamento</th>
                                <th>Dettagli</th>
                            </tr>
                        </thead>
                        <tbody id="chronology-body">
                            <!-- I dati della cronologia verranno inseriti qui -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="stats-container" id="stats-container">
                <!-- Le card delle statistiche verranno inserite qui -->
            </div>
            
            <div class="frequency-section">
                <h3 class="section-title">
                    <i class="fas fa-chart-line"></i> FREQUENZA DEI MOLTIPLICATORI
                </h3>
                
                <div class="frequency-grid" id="frequency-grid">
                    <!-- Le card di frequenza verranno inserite qui -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">Bonus Game: Cash Hunt!</div>

    <script>
        // Configurazione della nuova API
        const API_ENDPOINTS = {
            main: 'https://casinowizard.topadscron.it/crazy-time?hours=24'
        };
        const REFRESH_INTERVAL = 30000; // 30 secondi
        
        // Stato dell'applicazione
        let appState = {
            history: [],
            statistics: {},
            lastResultTime: null,
            isLoading: true,
            countdownInterval: null,
            errorState: false
        };
        
        // Mappatura dei tipi di gioco
        const gameTypes = {
            '1': { 
                name: '1', 
                class: 'segment-1', 
                fillClass: 'fill-1', 
                icon: '1',
                imageSrc: 'images/crazyTime/segment_1.png' 
            },
            '2': { 
                name: '2', 
                class: 'segment-2', 
                fillClass: 'fill-2', 
                icon: '2',
                imageSrc: 'images/crazyTime/segment_2.png' 
            },
            '5': { 
                name: '5', 
                class: 'segment-5', 
                fillClass: 'fill-5', 
                icon: '5',
                imageSrc: 'images/crazyTime/segment_5.png' 
            },
            '10': { 
                name: '10', 
                class: 'segment-10', 
                fillClass: 'fill-10', 
                icon: '10',
                imageSrc: 'images/crazyTime/segment_10.png'
            },
            'cash_hunt': { 
                name: 'Cash Hunt', 
                class: 'segment-cash_hunt', 
                fillClass: 'fill-ch', 
                icon: 'CH',
                imageSrc: 'images/crazyTime/cash_hunt.png'
            },
            'coinflip': { 
                name: 'CoinFlip', 
                class: 'segment-coinflip', 
                fillClass: 'fill-cf', 
                icon: 'CF',
                imageSrc: 'images/crazyTime/coinflip.png' 
            },
            'pachinko': { 
                name: 'Pachinko', 
                class: 'segment-pachinko', 
                fillClass: 'fill-p', 
                icon: 'P',
                imageSrc: 'images/crazyTime/pachinko.png' 
            },
            'crazy_time': { 
                name: 'Crazy Time', 
                class: 'segment-crazy_time', 
                fillClass: 'fill-ct', 
                icon: 'CT',
                imageSrc: 'images/crazyTime/crazy_time.png' 
            }
        };
        
        // Funzione per ottimizzare le immagini con dimensioni adeguate
        function optimizeImages() {
            // Seleziona tutte le immagini nella pagina
            const images = document.querySelectorAll('img');
            
            // Per ogni immagine, imposta gli attributi di loading e dimensioni
            images.forEach(img => {
                // Aggiungi lazy loading per migliorare le prestazioni
                if (!img.hasAttribute('loading')) {
                    img.setAttribute('loading', 'lazy');
                }
                
                // Assicurati che le immagini abbiano sempre object-fit: contain
                img.style.objectFit = 'contain';
                
                // Se è in un container con dimensioni specifiche, adatta l'immagine
                const parent = img.parentElement;
                if (parent.classList.contains('segment') || 
                    parent.classList.contains('stat-icon-container') || 
                    parent.classList.contains('frequency-icon')) {
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.maxWidth = '100%';
                }
                
                // Se è un'immagine nella tabella di cronologia, impostala a dimensioni fisse
                if (parent.classList.contains('slot-result') || parent.classList.contains('spin-result')) {
                    img.style.width = '40px';
                    img.style.height = '40px';
                    
                    // Riduci in mobile
                    if (window.innerWidth <= 768) {
                        img.style.width = '30px';
                        img.style.height = '30px';
                    }
                }
            });
        }
        
        // Funzione per gestire immagini mancanti
        function handleMissingImages() {
            document.addEventListener('error', function(e) {
                // Controlla se l'errore riguarda un'immagine
                if (e.target.tagName.toLowerCase() === 'img') {
                    console.warn('Immagine non caricata:', e.target.src);
                    
                    // Controlla se si tratta di un'immagine del gioco
                    if (e.target.src.includes('crazyTime')) {
                        // Sostituisci con un fallback
                        if (e.target.parentElement.classList.contains('segment-1')) {
                            e.target.parentElement.textContent = '1';
                        } else if (e.target.parentElement.classList.contains('segment-2')) {
                            e.target.parentElement.textContent = '2';
                        } else if (e.target.parentElement.classList.contains('segment-5')) {
                            e.target.parentElement.textContent = '5';
                        } else if (e.target.parentElement.classList.contains('segment-10')) {
                            e.target.parentElement.textContent = '10';
                        } else if (e.target.parentElement.classList.contains('segment-cash_hunt') || 
                                  e.target.parentElement.classList.contains('segment-bonus')) {
                            e.target.parentElement.textContent = 'CH';
                        } else if (e.target.parentElement.classList.contains('segment-coinflip')) {
                            e.target.parentElement.textContent = 'CF';
                        } else if (e.target.parentElement.classList.contains('segment-pachinko')) {
                            e.target.parentElement.textContent = 'P';
                        } else if (e.target.parentElement.classList.contains('segment-crazy_time')) {
                            e.target.parentElement.textContent = 'CT';
                        } else {
                            e.target.parentElement.textContent = '?';
                        }
                    }
                }
            }, true);
        }
        
        // Configurazione degli event listener quando il DOM è caricato
        document.addEventListener('DOMContentLoaded', () => {
            // Carica i dati iniziali
            loadCrazyTimeData();
            
            // Configura il refresh automatico
            setInterval(() => {
                loadCrazyTimeData(false);
            }, REFRESH_INTERVAL);
            
            // Configura il pulsante di refresh manuale
            document.getElementById('refresh-btn').addEventListener('click', () => {
                loadCrazyTimeData(true);
            });
            
            // Configura i filtri di tempo
            document.querySelectorAll('.time-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Rimuovi la classe active da tutti i pulsanti
                    document.querySelectorAll('.time-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Aggiungi la classe active al pulsante cliccato
                    button.classList.add('active');
                    
                    // Carica i dati con il nuovo filtro
                    const hours = button.getAttribute('data-hours');
                    loadCrazyTimeData(true, hours);
                });
            });
            
            // Gestisci immagini mancanti
            handleMissingImages();
            
            // Aggiungi la funzione di ottimizzazione immagini dopo il rendering
            const originalRenderUI = renderUI;
            renderUI = function() {
                originalRenderUI();
                optimizeImages();
            };
            
            // Aggiungi la funzione di ottimizzazione anche al resize della finestra
            window.addEventListener('resize', optimizeImages);
        });
        
        // Funzione principale per caricare i dati da CrazyTime
        async function loadCrazyTimeData(showLoading = true, timeFilter = null) {
            if (showLoading) {
                toggleLoading(true);
            }
            
            try {
                // Reset dello stato di errore
                appState.errorState = false;
                
                // Determina il filtro temporale
                const hours = timeFilter || (document.querySelector('.time-button.active')?.getAttribute('data-hours') || '6');
                
                // Costruisci l'URL dell'API con il filtro temporale
                const apiUrl = `https://casinowizard.topadscron.it/crazy-time?hours=${hours}`;
                
                // Carica i dati utilizzando la nuova API
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`Errore nella risposta API: ${response.status} ${response.statusText}`);
                }
                
                const apiData = await response.json();
                const processedData = processAPIData(apiData);
                
                // Aggiorna lo stato dell'applicazione
                updateAppState(processedData);
                
                // Renderizza l'interfaccia con i nuovi dati
                renderUI();
                
                // Se è un nuovo risultato, mostra una notifica
                checkForNewResult();
                
                // Aggiorna il countdown
                startCountdown();
                
                // Mostra notifica di conferma in caso di successo se è stato un refresh manuale
                if (showLoading) {
                    showNotification('Dati aggiornati con successo!');
                }
            } catch (error) {
                console.error('Errore nel caricamento dei dati:', error);
                appState.errorState = true;
                
                // Mostra l'errore nell'interfaccia
                showErrorState(error.message || 'Errore nel caricamento dei dati. Controlla la connessione e riprova.');
                
                // Mostra notifica di errore
                showNotification('Errore nel caricamento dei dati. Controlla la connessione e riprova.');
            } finally {
                if (showLoading) {
                    toggleLoading(false);
                }
            }
        }
        
        // Funzione per mostrare lo stato di errore nell'interfaccia
        function showErrorState(errorMessage) {
            // Aggiorna gli elementi principali
            const historyContainer = document.getElementById('history-container');
            if (historyContainer) {
                historyContainer.innerHTML = `
                    <div style="width: 100%; padding: 30px; text-align: center; color: #ff4c4c;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 15px;"></i>
                        <p>${errorMessage}</p>
                        <button id="retry-button" style="
                            margin-top: 15px;
                            padding: 10px 20px;
                            background: rgba(0, 20, 0, 0.8);
                            border: 1px solid rgba(0,255,76,0.3);
                            border-radius: 8px;
                            color: #00ff4c;
                            cursor: pointer;
                            font-weight: 600;
                            transition: all 0.3s ease;
                        ">Riprova</button>
                    </div>
                `;
                
                // Aggiungi il listener per il pulsante di riprova
                setTimeout(() => {
                    const retryButton = document.getElementById('retry-button');
                    if (retryButton) {
                        retryButton.addEventListener('click', () => {
                            loadCrazyTimeData(true);
                        });
                    }
                }, 100);
            }
            
            // Aggiorna gli altri contenitori
            const statsContainer = document.getElementById('stats-container');
            if (statsContainer) {
                statsContainer.innerHTML = '';
            }
            
            const frequencyGrid = document.getElementById('frequency-grid');
            if (frequencyGrid) {
                frequencyGrid.innerHTML = '';
            }
            
            // Aggiorna elementi informativi
            document.getElementById('last-result').textContent = 'Errore';
            document.getElementById('spins-24h').textContent = '--';
            
            // Ferma il countdown
            if (appState.countdownInterval) {
                clearInterval(appState.countdownInterval);
                appState.countdownInterval = null;
            }
            
            // Aggiorna il display del countdown
            document.getElementById('minutes').textContent = '--';
            document.getElementById('seconds').textContent = '--';
        }
        
        // Funzione per processare i dati dell'API
        function processAPIData(apiData) {
            const processedHistory = [];
            
            // Verifichiamo se i dati hanno la struttura corretta (data.resultsData)
            if (apiData && apiData.data && apiData.data.resultsData && Array.isArray(apiData.data.resultsData)) {
                // Mappiamo i risultati nel formato richiesto dalla nostra applicazione
                apiData.data.resultsData.forEach(item => {
                    // Determiniamo il tipo di risultato dal spinResultSymbol
                    let type = '';
                    const spinResult = item.spinResultSymbol;
                    
                    switch (spinResult) {
                        case 'one': type = '1'; break;
                        case 'two': type = '2'; break;
                        case 'five': type = '5'; break;
                        case 'ten': type = '10'; break;
                        case 'cashhunt': type = 'cash_hunt'; break;
                        case 'coinflip': type = 'coinflip'; break;
                        case 'pachinko': type = 'pachinko'; break;
                        case 'crazytime': type = 'crazy_time'; break;
                        default: 
                            console.warn('Tipo di risultato sconosciuto:', spinResult);
                            return; // Saltiamo questo elemento
                    }
                    
                    // Determiniamo il moltiplicatore
                    let multiplier = null;
                    if (item.multiplier) {
                        // Estrai il valore numerico dal formato "5X"
                        const multiplierStr = item.multiplier;
                        if (multiplierStr.endsWith('X')) {
                            multiplier = parseInt(multiplierStr.replace('X', ''));
                            if (isNaN(multiplier)) multiplier = null;
                        }
                    }
                    
                    // Determiniamo il timestamp
                    let timestamp = new Date().toISOString();
                    if (item.date) {
                        try {
                            timestamp = new Date(item.date).toISOString();
                        } catch (e) {
                            console.warn('Errore nella conversione del timestamp:', e);
                        }
                    }
                    
                    // Aggiungiamo informazioni aggiuntive
                    const hasTopSlotMatch = item.sameSlotAndSpinResult === true;
                    const slotResult = item.slotResult || 'Miss';
                    const totalPayout = item.totalPayout || 0;
                    const totalWinners = item.totalWinners || 0;
                    
                    // Aggiungiamo l'elemento processato allo storico
                    processedHistory.push({
                        type: type,
                        multiplier: multiplier,
                        timestamp: timestamp,
                        hasTopSlotMatch: hasTopSlotMatch,
                        slotResult: slotResult,
                        totalPayout: totalPayout,
                        totalWinners: totalWinners,
                        originalData: item // Manteniamo i dati originali per riferimento
                    });
                });
            } else {
                throw new Error('Struttura dati API non valida. Risposta ricevuta: ' + JSON.stringify(apiData).substring(0, 100) + '...');
            }
            
            // Ordiniamo lo storico per timestamp decrescente (più recente prima)
            processedHistory.sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            // Calcoliamo il numero di giri nelle ultime 24 ore
            const oneDayAgo = new Date();
            oneDayAgo.setHours(oneDayAgo.getHours() - 24);
            
            const spinsLast24h = processedHistory.filter(result => {
                const resultTime = new Date(result.timestamp);
                return resultTime >= oneDayAgo;
            }).length;
            
            // Calcoliamo le statistiche basate sullo storico
            const statistics = calculateStatistics(processedHistory);
            
            return {
                history: processedHistory,
                statistics: statistics,
                spinsLast24h: spinsLast24h
            };
        }
        
        // Calcola statistiche basate sulla storia e integra con i dati delle API
        function calculateStatistics(history, apiStatsData = null) {
            const stats = {
                totalSpins: history.length,
                segments: {
                    '1': { count: 0, multipliers: {} },
                    '2': { count: 0, multipliers: {} },
                    '5': { count: 0, multipliers: {} },
                    '10': { count: 0, multipliers: {} },
                    'cash_hunt': { count: 0 },
                    'coinflip': { count: 0 },
                    'pachinko': { count: 0 },
                    'crazy_time': { count: 0 }
                },
                bonusTotalCount: 0,
                spinsSinceLastBonus: 0,
                currentStreak: { type: null, count: 0 },
                frequencies: {},
                // Nuovi dati
                matchCount: 0,
                totalPayouts: 0,
                totalWinners: 0
            };
            
            // Conta i risultati dalla cronologia
            let lastBonusIndex = -1;
            
            // Verifichiamo che history sia un array valido
            if (!Array.isArray(history) || history.length === 0) {
                console.warn("Storia vuota o non valida, non è possibile calcolare le statistiche");
                return stats;
            }
            
            history.forEach((result, index) => {
                // Verifica che il tipo sia valido e che esista nei nostri segmenti configurati
                if (result && result.type && stats.segments[result.type]) {
                    // Incrementa il contatore per questo tipo
                    stats.segments[result.type].count++;
                    
                    // Registra il moltiplicatore, se presente
                    if (result.multiplier) {
                        if (!stats.segments[result.type].multipliers) {
                            stats.segments[result.type].multipliers = {};
                        }
                        
                        if (!stats.segments[result.type].multipliers[result.multiplier]) {
                            stats.segments[result.type].multipliers[result.multiplier] = 0;
                        }
                        stats.segments[result.type].multipliers[result.multiplier]++;
                    }
                    
                    // Traccia bonus game
                    if (['cash_hunt', 'coinflip', 'pachinko', 'crazy_time'].includes(result.type)) {
                        stats.bonusTotalCount++;
                        if (lastBonusIndex === -1) {
                            lastBonusIndex = index;
                        }
                    }
                    
                    // Traccia match con top slot
                    if (result.hasTopSlotMatch) {
                        stats.matchCount++;
                    }
                    
                    // Accumula vincite e vincitori
                    if (result.totalPayout) {
                        stats.totalPayouts += result.totalPayout;
                    }
                    
                    if (result.totalWinners) {
                        stats.totalWinners += result.totalWinners;
                    }
                } else if (result && result.type) {
                    console.warn(`Tipo di risultato non supportato: ${result.type}`);
                }
            });
            
            // Calcola spins da ultimo bonus
            stats.spinsSinceLastBonus = lastBonusIndex === -1 ? history.length : lastBonusIndex;
            
            // Calcola streaks attuali
            if (history.length > 0 && history[0] && history[0].type) {
                let currentType = history[0].type;
                let streakCount = 1;
                
                for (let i = 1; i < history.length; i++) {
                    if (history[i] && history[i].type === currentType) {
                        streakCount++;
                    } else {
                        break;
                    }
                }
                
                stats.currentStreak = {
                    type: currentType,
                    count: streakCount
                };
            }
            
            // Calcola frequenze (ad es. ogni quanti spin compare un bonus)
            stats.frequencies = calculateFrequencies(history);
            
            return stats;
        }
        
        // Calcola le frequenze di apparizione
        function calculateFrequencies(history) {
            // Verifichiamo che history sia un array valido
            if (!Array.isArray(history) || history.length === 0) {
                console.warn("Storia vuota o non valida, non è possibile calcolare le frequenze");
                return {
                    bonus: { lastHits: [], averageSpins: 0 },
                    segments: {
                        '1': { lastHits: [], averageSpins: 0 },
                        '2': { lastHits: [], averageSpins: 0 },
                        '5': { lastHits: [], averageSpins: 0 },
                        '10': { lastHits: [], averageSpins: 0 },
                        'cash_hunt': { lastHits: [], averageSpins: 0 },
                        'coinflip': { lastHits: [], averageSpins: 0 },
                        'pachinko': { lastHits: [], averageSpins: 0 },
                        'crazy_time': { lastHits: [], averageSpins: 0 }
                    }
                };
            }
            
            const frequencies = {
                bonus: { lastHits: [], averageSpins: 0 },
                segments: {
                    '1': { lastHits: [], averageSpins: 0 },
                    '2': { lastHits: [], averageSpins: 0 },
                    '5': { lastHits: [], averageSpins: 0 },
                    '10': { lastHits: [], averageSpins: 0 },
                    'cash_hunt': { lastHits: [], averageSpins: 0 },
                    'coinflip': { lastHits: [], averageSpins: 0 },
                    'pachinko': { lastHits: [], averageSpins: 0 },
                    'crazy_time': { lastHits: [], averageSpins: 0 }
                }
            };
            
            // Trova le ultime occorrenze di ogni segmento
            const segmentPositions = {
                '1': [],
                '2': [],
                '5': [],
                '10': [],
                'cash_hunt': [],
                'coinflip': [],
                'pachinko': [],
                'crazy_time': [],
                'bonus': [] // Qualsiasi bonus game
            };
            
            // Identifica la posizione di ogni tipo nel flusso della storia
            history.forEach((result, index) => {
                // Verifichiamo che il risultato sia valido e abbia un tipo
                if (result && result.type) {
                    // Verifichiamo che il tipo sia tra quelli che ci interessano
                    if (segmentPositions.hasOwnProperty(result.type)) {
                        segmentPositions[result.type].push(index);
                    }
                    
                    // Aggiungi anche ai bonus se è un bonus game
                    if (['cash_hunt', 'coinflip', 'pachinko', 'crazy_time'].includes(result.type)) {
                        segmentPositions['bonus'].push(index);
                    }
                }
            });
            
            // Calcola le differenze tra occorrenze consecutive per ogni tipo
            Object.keys(segmentPositions).forEach(type => {
                const positions = segmentPositions[type];
                if (positions.length > 0) {
                    // Calcola distanze tra occorrenze consecutive
                    const gaps = [];
                    for (let i = 0; i < positions.length - 1; i++) {
                        gaps.push(positions[i] - positions[i + 1]);
                    }
                    
                    // Salva le ultime occorrenze (distanza attuale)
                    if (type === 'bonus') {
                        frequencies.bonus.lastHits = gaps.slice(0, 5);
                        frequencies.bonus.averageSpins = gaps.length > 0 ? 
                            Math.round(gaps.reduce((sum, val) => sum + val, 0) / gaps.length) : 0;
                    } else {
                        // Verifichiamo che il tipo esista nelle frequenze
                        if (frequencies.segments.hasOwnProperty(type)) {
                            frequencies.segments[type].lastHits = gaps.slice(0, 5);
                            frequencies.segments[type].averageSpins = gaps.length > 0 ? 
                                Math.round(gaps.reduce((sum, val) => sum + val, 0) / gaps.length) : 0;
                        }
                    }
                }
            });
            
            return frequencies;
        }
        
        // Aggiorna lo stato dell'applicazione
        function updateAppState(data) {
            appState.history = data.history;
            appState.statistics = data.statistics;
            appState.spinsLast24h = data.spinsLast24h || 0;
            
            // Salva l'orario dell'ultimo risultato
            if (appState.history.length > 0) {
                const newResultTime = new Date(appState.history[0].timestamp);
                
                // Se abbiamo un risultato precedente e questo è nuovo, salva il tempo
                if (!appState.lastResultTime || 
                    newResultTime.getTime() !== appState.lastResultTime.getTime()) {
                    appState.isNewResult = true;
                    appState.lastResultTime = newResultTime;
                } else {
                    appState.isNewResult = false;
                }
            }
            
            // Aggiorna il contatore dei giri delle ultime 24 ore
            document.getElementById('spins-24h').textContent = appState.spinsLast24h;
            
            // Aggiorna il testo di riepilogo
            const summaryInfo = document.getElementById('summary-info');
            if (summaryInfo) {
                // Trova il bottone attivo
                const activeButton = document.querySelector('.time-button.active');
                const hours = activeButton ? activeButton.getAttribute('data-hours') : '6';
                const count = appState.history ? appState.history.length : 0;
                
                summaryInfo.textContent = `Ultime ${hours} ore - ${count} Giocate`;
            }
        }
        
        // Renderizza l'interfaccia con i dati attuali
        function renderUI() {
            // Se siamo in stato di errore o non abbiamo dati, non fare niente
            if (appState.errorState || !appState.history || appState.history.length === 0) return;
            
            try {
                // Aggiorna il risultato più recente
                updateLastResult();
                
                // Aggiorna lo storico
                renderHistory();
                
                // Aggiorna la tabella cronologica
                renderChronologyTable();
                
                // Aggiorna i totali
                document.getElementById('spins-24h').textContent = appState.spinsLast24h || 0;
                
                // Renderizza le card statistiche
                renderStatCards();
                
                // Renderizza le card di frequenza
                renderFrequencyCards();
                
                // Aggiorna il timestamp dell'ultimo aggiornamento
                document.title = `CrazyTime Stats - Aggiornato ${new Date().toLocaleTimeString()}`;
                
                // Aggiungi l'info dell'ultimo aggiornamento se non esiste già
                if (!document.getElementById('last-update-info')) {
                    const statusRow = document.querySelector('.status-row');
                    if (statusRow) {
                        const updateInfoCard = document.createElement('div');
                        updateInfoCard.className = 'status-card';
                        updateInfoCard.id = 'last-update-info';
                        updateInfoCard.innerHTML = `
                            <div class="status-label">Ultimo Aggiornamento</div>
                            <div class="status-value">${new Date().toLocaleTimeString()}</div>
                        `;
                        statusRow.appendChild(updateInfoCard);
                    }
                } else {
                    // Aggiorna l'orario dell'ultimo aggiornamento
                    const updateValueElement = document.getElementById('last-update-info').querySelector('.status-value');
                    if (updateValueElement) {
                        updateValueElement.textContent = new Date().toLocaleTimeString();
                    }
                }
            } catch (error) {
                console.error('Errore durante il rendering dell\'interfaccia:', error);
                showNotification('Si è verificato un errore durante l\'aggiornamento dell\'interfaccia.');
            }
        }
        
        // Aggiorna il risultato più recente
        function updateLastResult() {
            const lastResult = appState.history[0];
            const resultElement = document.getElementById('last-result');
            const gameInfo = gameTypes[lastResult.type];
            
            let resultText = gameInfo.name;
            
            // Aggiungi info sul moltiplicatore
            if (lastResult.multiplier) {
                resultText += ` (${lastResult.multiplier}×)`;
            }
            
            // Aggiungi info se è stato un match con il top slot
            if (lastResult.hasTopSlotMatch) {
                resultText += " ⭐";
                resultElement.setAttribute("title", "Match con Top Slot!");
            } else {
                resultElement.removeAttribute("title");
            }
            
            resultElement.textContent = resultText;
            resultElement.className = 'status-value ' + gameInfo.fillClass;
        }
        
        // Renderizza lo storico dei risultati con immagini ottimizzate
        function renderHistory() {
            const historyContainer = document.getElementById('history-container');
            if (!historyContainer) return;
            
            historyContainer.innerHTML = '';
            
            // Verifichiamo che ci siano dati da visualizzare
            if (!appState.history || appState.history.length === 0) {
                historyContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #ccc;">Nessun dato disponibile</div>';
                return;
            }
            
            appState.history.forEach(result => {
                if (!result || !result.type || !gameTypes[result.type]) {
                    console.warn("Risultato non valido:", result);
                    return;
                }
                
                const gameInfo = gameTypes[result.type];
                
                const segmentElement = document.createElement('div');
                segmentElement.className = `segment ${gameInfo.class}`;
                
                // Usa l'immagine se disponibile, altrimenti mostra il testo
                if (gameInfo.imageSrc) {
                    const imgElement = document.createElement('img');
                    imgElement.src = gameInfo.imageSrc;
                    imgElement.alt = gameInfo.name;
                    imgElement.setAttribute('loading', 'lazy');
                    imgElement.style.width = '100%';
                    imgElement.style.height = '100%';
                    imgElement.style.objectFit = 'contain';
                    segmentElement.appendChild(imgElement);
                } else {
                    segmentElement.textContent = gameInfo.icon;
                }
                
                // Aggiungi moltiplicatore se presente
                if (result.multiplier) {
                    const multiplierElement = document.createElement('div');
                    multiplierElement.className = 'segment-multiplier';
                    multiplierElement.textContent = `${result.multiplier}×`;
                    segmentElement.appendChild(multiplierElement);
                }
                
                // Aggiungi stella se c'è stato un match con il top slot
                if (result.hasTopSlotMatch) {
                    segmentElement.style.border = '2px solid gold';
                    segmentElement.style.boxShadow = '0 0 10px rgba(255, 215, 0, 0.7)';
                }
                
                // Tooltip con data, ora e altre info
                const timestamp = new Date(result.timestamp);
                const timeString = timestamp.toLocaleTimeString();
                const dateString = timestamp.toLocaleDateString();
                
                let tooltipText = `${gameInfo.name}${result.multiplier ? ' (' + result.multiplier + '×)' : ''} - ${dateString} ${timeString}`;
                
                // Aggiungi info sul vincitore e sulle vincite se disponibili
                if (result.totalWinners && result.totalPayout) {
                    tooltipText += `\nVincitori: ${result.totalWinners.toLocaleString()}`;
                    tooltipText += `\nVincita Totale: ${result.totalPayout.toLocaleString()}`;
                }
                
                // Aggiungi info sul risultato dello slot se disponibile
                if (result.slotResult && result.slotResult !== 'Miss') {
                    tooltipText += `\nSlot: ${result.slotResult}`;
                }
                
                segmentElement.title = tooltipText;
                
                historyContainer.appendChild(segmentElement);
            });
        }
        
        // Renderizza la tabella cronologica con dimensioni ottimizzate
        function renderChronologyTable() {
            try {
                const chronologyBody = document.getElementById('chronology-body');
                if (!chronologyBody) {
                    console.warn('Elemento chronology-body non trovato');
                    return;
                }
                
                chronologyBody.innerHTML = '';
                
                // Verifichiamo che ci siano dati da visualizzare
                if (!appState.history || appState.history.length === 0) {
                    chronologyBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #ccc;">Nessun dato disponibile</td></tr>';
                    return;
                }
                
                // Limitiamo a 20 risultati per evitare che la tabella diventi troppo lunga
                const displayedResults = appState.history.slice(0, 20);
                
                displayedResults.forEach(result => {
                    if (!result || !result.type || !gameTypes[result.type]) {
                        console.warn("Risultato non valido per la tabella:", result);
                        return;
                    }
                    
                    const row = document.createElement('tr');
                    
                    // Data e ora
                    const timestamp = new Date(result.timestamp);
                    const dateTimeCell = document.createElement('td');
                    dateTimeCell.className = 'datetime';
                    dateTimeCell.innerHTML = `${timestamp.toLocaleDateString()}<br>${timestamp.toLocaleTimeString()}`;
                    row.appendChild(dateTimeCell);
                    
                    // Risultato Slot
                    const slotResultCell = document.createElement('td');
                    slotResultCell.className = 'slot-result';
                    
                    // Se abbiamo dati sullo slot
                    if (result.originalData && result.originalData.slotResultSymbol) {
                        const slotType = convertSymbolToType(result.originalData.slotResultSymbol);
                        if (slotType && gameTypes[slotType]) {
                            const slotGameInfo = gameTypes[slotType];
                            
                            if (slotGameInfo.imageSrc) {
                                const slotImg = document.createElement('img');
                                slotImg.src = slotGameInfo.imageSrc;
                                slotImg.alt = slotGameInfo.name;
                                slotImg.style.width = '40px';
                                slotImg.style.height = '40px';
                                slotImg.setAttribute('loading', 'lazy');
                                slotResultCell.appendChild(slotImg);
                            } else {
                                slotResultCell.textContent = slotGameInfo.icon || 'Miss';
                            }
                        } else {
                            slotResultCell.textContent = 'Miss';
                        }
                    } else {
                        slotResultCell.textContent = 'Miss';
                    }
                    
                    row.appendChild(slotResultCell);
                    
                    // Risultato Spin
                    const spinResultCell = document.createElement('td');
                    spinResultCell.className = 'spin-result';
                    
                    const gameInfo = gameTypes[result.type];
                    if (gameInfo && gameInfo.imageSrc) {
                        const spinImg = document.createElement('img');
                        spinImg.src = gameInfo.imageSrc;
                        spinImg.alt = gameInfo.name;
                        spinImg.style.width = '40px';
                        spinImg.style.height = '40px';
                        spinImg.setAttribute('loading', 'lazy');
                        spinResultCell.appendChild(spinImg);
                    } else if (gameInfo) {
                        spinResultCell.textContent = gameInfo.icon;
                    } else {
                        spinResultCell.textContent = '-';
                    }
                    
                    row.appendChild(spinResultCell);
                    
                    // Moltiplicatore
                    const multiplierCell = document.createElement('td');
                    multiplierCell.className = 'multiplier';
                    multiplierCell.textContent = result.multiplier ? `${result.multiplier}×` : '1×';
                    row.appendChild(multiplierCell);
                    
                    // Pagamento
                    const paymentCell = document.createElement('td');
                    paymentCell.className = 'payment';
                    paymentCell.textContent = result.totalPayout ? `€${result.totalPayout.toLocaleString()}` : '-';
                    row.appendChild(paymentCell);
                    
                    // Dettagli
                    const detailsCell = document.createElement('td');
                    const detailsButton = document.createElement('button');
                    detailsButton.className = 'details-button';
                    detailsButton.innerHTML = '<i class="fas fa-info-circle"></i>';
                    detailsButton.style.background = 'rgba(0,255,76,0.2)';
                    detailsButton.style.border = '1px solid rgba(0,255,76,0.5)';
                    detailsButton.style.borderRadius = '50%';
                    detailsButton.style.width = '32px';
                    detailsButton.style.height = '32px';
                    detailsButton.style.cursor = 'pointer';
                    detailsButton.style.color = '#00ff4c';
                    
                    // Modifica della gestione dell'evento click
                    detailsButton.addEventListener('click', function(e) {
                        e.stopPropagation(); // Ferma la propagazione
                        showGameDetails(result);
                    });
                    
                    detailsCell.appendChild(detailsButton);
                    row.appendChild(detailsCell);
                    
                    chronologyBody.appendChild(row);
                });
            } catch (error) {
                console.error('Errore durante il rendering della tabella cronologica:', error);
            }
        }
        
        // Funzione per convertire simboli in tipi
        function convertSymbolToType(symbol) {
            if (!symbol) return null;
            
            const symbolMap = {
                'one': '1',
                'two': '2',
                'five': '5',
                'ten': '10',
                'cashhunt': 'cash_hunt',
                'coinflip': 'coinflip',
                'pachinko': 'pachinko',
                'crazytime': 'crazy_time'
            };
            
            return symbolMap[symbol.toLowerCase()] || null;
        }
        
        // Mostra i dettagli del gioco in un popup ottimizzato
        function showGameDetails(result) {
            if (!result) return;
            
            try {
                const gameInfo = gameTypes[result.type];
                const timestamp = new Date(result.timestamp);
                
                // Rimuovi popup esistenti per evitare sovrapposizioni
                const existingPopup = document.getElementById('detail-popup');
                if (existingPopup) {
                    existingPopup.parentNode.removeChild(existingPopup);
                }
                
                // Crea un semplice popup
                const popup = document.createElement('div');
                popup.id = 'detail-popup';
                popup.style.position = 'fixed';
                popup.style.top = '50%';
                popup.style.left = '50%';
                popup.style.transform = 'translate(-50%, -50%)';
                popup.style.padding = '25px';
                popup.style.background = 'rgba(0, 20, 0, 0.95)';
                popup.style.borderRadius = '16px';
                popup.style.border = '2px solid rgba(0,255,76,0.7)';
                popup.style.boxShadow = '0 10px 30px rgba(0,0,0,0.7), 0 0 20px rgba(0,255,76,0.3)';
                popup.style.zIndex = '2000';
                popup.style.minWidth = '300px';
                popup.style.maxWidth = '500px';
                popup.style.maxHeight = '90vh';
                popup.style.overflow = 'auto';
                
                // Aggiungi il contenuto
                popup.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #00ff4c;">Dettagli Risultato</h3>
                        <button id="close-popup" style="background: none; border: none; color: #ccc; cursor: pointer; font-size: 20px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; align-items: center;">
                        <div style="width: 60px; height: 60px; border-radius: 8px; overflow: hidden; background: ${gameInfo.class ? 'linear-gradient(135deg, #35cf69, #58fa8d)' : ''}">
                            ${gameInfo.imageSrc ? `<img src="${gameInfo.imageSrc}" alt="${gameInfo.name}" style="width: 100%; height: 100%; object-fit: contain;">` : 
                            `<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700;">${gameInfo.icon}</div>`}
                        </div>
                        
                        <div>
                            <h4 style="margin: 0 0 5px 0;">${gameInfo.name}</h4>
                            <p style="margin: 0; color: #ccc; font-size: 14px;">${timestamp.toLocaleDateString()} ${timestamp.toLocaleTimeString()}</p>
                            ${result.multiplier ? `<p style="margin: 10px 0 0 0; color: #FF9900; font-weight: 700;">Moltiplicatore: ${result.multiplier}×</p>` : ''}
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        ${result.totalWinners ? `<p style="margin: 5px 0;">Vincitori: <b>${result.totalWinners.toLocaleString()}</b></p>` : ''}
                        ${result.totalPayout ? `<p style="margin: 5px 0;">Vincita Totale: <b style="color: #00ff4c;">€${result.totalPayout.toLocaleString()}</b></p>` : ''}
                        
                        ${result.hasTopSlotMatch ? 
                            `<div style="margin-top: 15px; padding: 10px; background: rgba(255, 215, 0, 0.1); border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.3);">
                                <p style="margin: 0; color: gold;"><i class="fas fa-star"></i> Match con Top Slot!</p>
                            </div>` : ''}
                    </div>
                `;
                
                // Aggiungi al body
                document.body.appendChild(popup);
                
                // Aggiungi event listener per chiudere
                const closeBtn = document.getElementById('close-popup');
                if (closeBtn) {
                    closeBtn.addEventListener('click', closePopup);
                }
                
                // Chiudi cliccando al di fuori
                document.addEventListener('click', closePopupOutside);
                
                function closePopup() {
                    if (popup && popup.parentNode) {
                        popup.parentNode.removeChild(popup);
                    }
                    document.removeEventListener('click', closePopupOutside);
                }
                
                function closePopupOutside(e) {
                    if (popup && !popup.contains(e.target)) {
                        closePopup();
                    }
                }
                
            } catch (error) {
                console.error('Errore durante la visualizzazione dei dettagli:', error);
                showNotification('Errore durante la visualizzazione dei dettagli');
            }
        }
        
        // Renderizza le card delle statistiche
        function renderStatCards() {
            const statsContainer = document.getElementById('stats-container');
            statsContainer.innerHTML = '';
            
            // Card per i segmenti numerici
            const numberTypes = ['1', '2', '5', '10'];
            numberTypes.forEach(type => {
                const card = createStatCard(type);
                statsContainer.appendChild(card);
            });
            
            // Card per i bonus games
            const bonusTypes = ['cash_hunt', 'coinflip', 'pachinko', 'crazy_time'];
            bonusTypes.forEach(type => {
                const card = createStatCard(type);
                statsContainer.appendChild(card);
            });
            
            // Card aggiuntive per statistiche speciali
            const streakCard = document.createElement('div');
            streakCard.className = 'stat-card';
            streakCard.innerHTML = `
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #35cfcf, #58fafa); color: black;">
                        <i class="fas fa-fire"></i>
                    </div>
                    <h3 class="stat-title">Sequenza Attuale</h3>
                </div>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">Tipo</div>
                        <div class="stat-value">${gameTypes[appState.statistics.currentStreak.type].icon}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Conteggio</div>
                        <div class="stat-value">${appState.statistics.currentStreak.count}</div>
                    </div>
                </div>
            `;
            statsContainer.appendChild(streakCard);
            
            const bonusWaitCard = document.createElement('div');
            bonusWaitCard.className = 'stat-card';
            bonusWaitCard.innerHTML = `
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #35cf69, #58fa8d); color: black;">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <h3 class="stat-title">Attesa Bonus</h3>
                </div>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">Giri Da Ultimo</div>
                        <div class="stat-value">${appState.statistics.spinsSinceLastBonus}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Probabilità</div>
                        <div class="stat-value">${Math.round((appState.statistics.bonusTotalCount / appState.statistics.totalSpins) * 100)}%</div>
                    </div>
                </div>
                <div class="probability-bar">
                    <div class="probability-fill fill-ch" style="width: ${(appState.statistics.bonusTotalCount / appState.statistics.totalSpins) * 100}%"></div>
                </div>
            `;
            statsContainer.appendChild(bonusWaitCard);
        }
        
        // Crea una card statistica per un tipo specifico
        function createStatCard(type) {
            // Verifichiamo che il tipo sia valido
            if (!gameTypes[type]) {
                console.warn(`Tipo non valido per card statistica: ${type}`);
                return document.createElement('div'); // Restituisci un div vuoto
            }
            
            const gameInfo = gameTypes[type];
            
            // Verifichiamo che le statistiche siano state calcolate correttamente
            if (!appState.statistics || !appState.statistics.segments || !appState.statistics.segments[type]) {
                console.warn(`Statistiche mancanti per il tipo: ${type}`);
                return document.createElement('div'); // Restituisci un div vuoto
            }
            
            const stats = appState.statistics.segments[type];
            const totalSpins = appState.statistics.totalSpins || 1; // Evita divisione per zero
            const totalPercentage = (stats.count / totalSpins) * 100;
            
            const card = document.createElement('div');
            card.className = 'stat-card';
            
            // Se ci sono moltiplicatori, creali come tabella
            let multiplierContent = '';
            if (stats.multipliers && Object.keys(stats.multipliers).length > 0) {
                multiplierContent = `
                    <div class="multiplier-section" style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;">
                        ${Object.entries(stats.multipliers)
                            .sort(([a], [b]) => parseInt(b) - parseInt(a))
                            .slice(0, 6) // Limitiamo a 6 moltiplicatori per card
                            .map(([mult, count]) => `
                                <div class="multiplier-item">
                                    <div class="multiplier-value">${mult}×</div>
                                    <div class="multiplier-count">${count}</div>
                                </div>
                            `).join('')}
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="stat-header">
                    <div class="stat-icon ${gameInfo.class}" style="width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        ${gameInfo.imageSrc ? 
                            `<img src="${gameInfo.imageSrc}" alt="${gameInfo.name}" loading="lazy" style="width: 100%; height: 100%; object-fit: contain;">` : 
                            `<span style="font-size: 14px; font-weight: 700;">${gameInfo.icon}</span>`}
                    </div>
                    <h3 class="stat-title">${gameInfo.name}</h3>
                </div>
                <div style="margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div>
                            <div style="color: #888; font-size: 12px;">Totale</div>
                            <div style="font-size: 22px; font-weight: 800;">${stats.count}</div>
                        </div>
                        <div>
                            <div style="color: #888; font-size: 12px;">Percentuale</div>
                            <div style="font-size: 22px; font-weight: 800;">${totalPercentage.toFixed(1)}%</div>
                        </div>
                    </div>
                    ${multiplierContent}
                    <div class="probability-bar" style="margin-top: 15px;">
                        <div class="probability-fill ${gameInfo.fillClass}" style="width: ${totalPercentage}%"></div>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Renderizza le card di frequenza
        function renderFrequencyCards() {
            try {
                const frequencyGrid = document.getElementById('frequency-grid');
                frequencyGrid.innerHTML = '';
                
                // Card per tutti i bonus
                const bonusFrequencyCard = createFrequencyCard('bonus', 'Tutti i Bonus');
                frequencyGrid.appendChild(bonusFrequencyCard);
                
                // Card per ogni segmento
                Object.keys(gameTypes).forEach(type => {
                    const gameInfo = gameTypes[type];
                    const frequencyCard = createFrequencyCard(type, gameInfo.name);
                    frequencyGrid.appendChild(frequencyCard);
                });
            } catch (error) {
                console.error('Errore durante il rendering delle frequency card:', error);
                const frequencyGrid = document.getElementById('frequency-grid');
                frequencyGrid.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #ff4c4c;">
                        <i class="fas fa-exclamation-triangle"></i> Errore nel rendering delle frequenze: ${error.message}
                    </div>
                `;
            }
        }
        
        // Crea una card di frequenza
        function createFrequencyCard(type, name) {
            try {
                let frequencyData;
                let fillClass;
                
                // Verifichiamo che i dati di frequenza siano disponibili
                if (!appState.statistics || !appState.statistics.frequencies) {
                    console.warn('Dati di frequenza non disponibili');
                    return document.createElement('div'); // Restituisci un div vuoto
                }
                
                if (type === 'bonus') {
                    frequencyData = appState.statistics.frequencies.bonus || { lastHits: [], averageSpins: 0 };
                    fillClass = 'fill-ch';
                } else {
                    // Verifichiamo che il tipo sia valido
                    if (!gameTypes[type]) {
                        console.warn(`Tipo non valido per card frequenza: ${type}`);
                        return document.createElement('div'); // Restituisci un div vuoto
                    }
                    
                    if (!appState.statistics.frequencies.segments || !appState.statistics.frequencies.segments[type]) {
                        console.warn(`Dati di frequenza mancanti per il tipo: ${type}`);
                        return document.createElement('div'); // Restituisci un div vuoto
                    }
                    
                    frequencyData = appState.statistics.frequencies.segments[type];
                    fillClass = gameTypes[type].fillClass;
                }
                
                // Calcola il progresso corrente
                const lastHits = frequencyData.lastHits || [];
                const averageSpins = frequencyData.averageSpins || 0;
                
                let current = 0;
                if (type === 'bonus') {
                    current = appState.statistics.spinsSinceLastBonus || 0;
                } else {
                    // Trova l'indice della prima occorrenza di questo tipo nella storia
                    const index = appState.history.findIndex(r => r && r.type === type);
                    current = index >= 0 ? index : 0;
                }
                
                // Evita divisione per zero
                const progressPercentage = averageSpins > 0 ? 
                    Math.min(100, (current / averageSpins) * 100) : 0;
                
                const card = document.createElement('div');
                card.className = 'frequency-card';
                
                // Prepara i dati degli ultimi intervalli
                let lastHitsHTML = '';
                if (lastHits.length > 0) {
                    lastHitsHTML = lastHits.map(hit => `<td>${hit || '-'}</td>`).join('');
                } else {
                    lastHitsHTML = '<td colspan="5">Nessun dato</td>';
                }
                
                const gameInfo = type !== 'bonus' ? gameTypes[type] : { 
                    name: 'Tutti i Bonus', 
                    icon: 'B',
                    imageSrc: 'images/crazyTime/bonus_all.png',
                    class: 'segment-bonus'
                };
                
                card.innerHTML = `
                    <div class="frequency-header">
                        <div class="frequency-icon ${type !== 'bonus' ? gameInfo.class : 'segment-bonus'}" style="width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            ${gameInfo.imageSrc ? 
                                `<img src="${gameInfo.imageSrc}" alt="${gameInfo.name}" loading="lazy" style="width: 100%; height: 100%; object-fit: contain;">` : 
                                `<span style="font-size: 14px; font-weight: 700;">${gameInfo.icon}</span>`}
                        </div>
                        <h3 class="frequency-title">${name}</h3>
                    </div>
                    
                    <div class="spins-data">
                        <div class="spins-item">
                            <div class="spins-label">Media</div>
                            <div class="spins-value">${averageSpins || '-'}</div>
                        </div>
                        <div class="spins-item">
                            <div class="spins-label">Attuale</div>
                            <div class="spins-value">${current}</div>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <div class="progress-text">Progresso</div>
                            <div class="progress-percentage">${progressPercentage.toFixed(0)}%</div>
                        </div>
                        <div class="probability-bar">
                            <div class="probability-fill ${fillClass}" style="width: ${progressPercentage}%"></div>
                        </div>
                    </div>
                    
                    <table class="last-hits-table">
                        <tr>
                            <th colspan="5">Ultimi Intervalli</th>
                        </tr>
                        <tr>
                            ${lastHitsHTML}
                        </tr>
                    </table>
                `;
                
                return card;
            } catch (error) {
                console.error(`Errore nella creazione della card di frequenza per ${type}:`, error);
                const errorCard = document.createElement('div');
                errorCard.className = 'frequency-card';
                errorCard.innerHTML = `
                    <div style="padding: 10px; color: #ff4c4c;">
                        <i class="fas fa-exclamation-triangle"></i> Errore: ${error.message}
                    </div>
                `;
                return errorCard;
            }
        }
        
        // Controlla se c'è un nuovo risultato e mostra notifica
        function checkForNewResult() {
            if (appState.isNewResult && appState.history.length > 0) {
                const lastResult = appState.history[0];
                const gameInfo = gameTypes[lastResult.type];
                
                // Mostra notifica per tutti i risultati o solo per i bonus
                const isBonus = ['cash_hunt', 'coinflip', 'pachinko', 'crazy_time'].includes(lastResult.type);
                if (isBonus || Math.random() < 0.3) { // Mostra sempre per i bonus, a volte per i normali
                    const message = `Nuovo risultato: ${gameInfo.name}${lastResult.multiplier ? ' (' + lastResult.multiplier + '×)' : ''}`;
                    showNotification(message);
                }
                
                appState.isNewResult = false;
            }
        }
        
        // Avvia il countdown al prossimo risultato
        function startCountdown() {
            // Cancella l'intervallo precedente se esiste
            if (appState.countdownInterval) {
                clearInterval(appState.countdownInterval);
            }
            
            // Calcola il tempo rimanente (circa 30 secondi dopo l'ultimo risultato)
            let secondsRemaining = 30;
            if (appState.lastResultTime) {
                const now = new Date();
                const lastResultTime = appState.lastResultTime;
                const elapsedSeconds = Math.floor((now - lastResultTime) / 1000);
                secondsRemaining = Math.max(0, 30 - (elapsedSeconds % 30));
            }
            
            updateCountdownDisplay(secondsRemaining);
            
            // Avvia l'intervallo
            appState.countdownInterval = setInterval(() => {
                secondsRemaining--;
                
                if (secondsRemaining <= 0) {
                    clearInterval(appState.countdownInterval);
                    // Ricarica i dati quando il timer raggiunge 0
                    loadCrazyTimeData(false);
                } else {
                    updateCountdownDisplay(secondsRemaining);
                }
            }, 1000);
        }
        
        // Aggiorna il display del countdown
        function updateCountdownDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(remainingSeconds).padStart(2, '0');
            
            // Aggiungi animazione quando mancano pochi secondi
            const secondsElement = document.getElementById('seconds');
            if (seconds <= 5) {
                secondsElement.classList.add('blink');
            } else {
                secondsElement.classList.remove('blink');
            }
        }
        
        // Mostra/nasconde l'overlay di caricamento
        function toggleLoading(show) {
            const loadingOverlay = document.getElementById('loading-overlay');
            
            if (show) {
                loadingOverlay.style.display = 'flex';
                appState.isLoading = true;
            } else {
                loadingOverlay.style.display = 'none';
                appState.isLoading = false;
            }
        }
        
        // Mostra una notifica
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
    </script>
</body>
</html>